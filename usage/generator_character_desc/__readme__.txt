-- Name: Генератор характеристик NPC
-- Author: Vova Miller (vovamiller_97@mail.ru)

--##############
--#### ПОЛЯ ####
--##############
$GENMODE
    Метод генерации. Определяет то, как будет вести себя генерация при заданных списках оружия (см. ниже про поля w0, w1, w2).
    Возможные значения (без кавычек):
        - "0" или "w0+w1*w2"
            * Будет сгенерировано len(w0) + len(w1)*len(w2) характеристик, т.е. для каждого автомата будет перебран каждый пистолет.
        - "1" или "unique"
            * Уникальная характеристика: len(w0) + len(w1)*len(w2) == 1.
            * Для id характеристики в xml не будет добавлен постфикс _defaultN.
        - "2" или "w0+w2"
            * Будет сгенерировано len(w0) + len(w2) характеристик, т.е. для каждого автомата будет выбран детерминировано один пистолет.
            * В каждой новой настройке с тем же классом индекс для выбора пистолета смещается, так что одному автомату не будет всегда соответствовать один и тот же пистолет.
    Указывается ОБЯЗАТЕЛЬНО.
name
    Имя NPC.
    Если не указано, то восстанавливается автоматически по группировке и, в случае военных, по рангу.
icon
    Иконка.
    Если не указана, то
        - для группировки зомбированных приравнивается ui_npc_u_none (если такая иконка существует)
        - в остальном, формируется по принципу ui_npc_u_<visual_name>
bio
    Информация о персонаже.
    На оригинальном движке бесполезно. Но, например, на OGSR Engine отображается при нажатии на NPC в списке контактов КПК.
    Если не указано, то просто не добавляется в характеристику.
class
    Класс, т.е. имя характеристики.
    Указывается ОБЯЗАТЕЛЬНО.
community
    Группировка NPC.
    Указывается ОБЯЗАТЕЛЬНО.
terrain_sect
    Секция террейна, что бы то ни значило.
    Если не указано, то просто не добавляется в характеристику.
rank
    Ранг NPC.
    Если указано число, то таким будет ранг NPC.
    Если указаны два числа через запятую, то ранг для каждой характеристики выбирается случайно между этими числами.
    Можно указать сокращения, обозначающие опытность NPC, и число ранга будет выбрано случайным образом в рамках указанной опытности. Возможные сокращения: novice, experienced, veteran, master, 1n, 2e, 3v, 4m. Предполагается, что границы рангов не модифицированы, т.е. остались равными 300/600/900 как в оригинале; иными словами, эти сокращения не опираются на строчку rating_names из [game_relations].
    Сокращения также можно использовать парой или в сочетании с обычным числом.
    Примеры:
        rank = 100          ; ровно 100
        rank = 100, 200     ; случайное число от 100 до 200 (включительно)
        rank = 1n           ; rank = 100, 299 (новичок; почему не от нуля - см. ниже)
        rank = 2e           ; rank = 300, 599 (опытный)
        rank = 2e, 2e       ; rank = 300, 599 (опытный)
        rank = 2e, 3v       ; rank = 300, 899 (опытный или ветеран)
        rank = 2e, 4m       ; rank = 300, 999 (опытный, ветеран или мастер)
        rank = 2e, 400      ; rank = 300, 400
        rank = 200, 2e      ; rank = 200, 599
    Допускаются только неотрицательные числа.
    При указании ранга числом, рекомендуется использовать только числа не меньше 100, чтобы избежать движкового бага с абсурдной точностью стрельбы NPC.
    Указывается ОБЯЗАТЕЛЬНО.
reputation
    Репутация NPC.
    Если указано число, то такой будет репутация NPC.
    Если указаны два числа через запятую, то репутация для каждой характеристики выбирается случайно между этими числами.
    Как и с рангами, поддерживаются сокращения:
        terrible:   -1500, -1001        ; ужасно
        very_bad:   -1000,  -151        ; оч. плохо
        bad:        -150,    -51        ; плохо
        neutral:    -50,      49        ; нейтрал
        good:        50,     149        ; хорошо
        very_good:   150,    999        ; оч. хорошо
        excellent:   1000,  1500        ; отлично
    Значения сокращений строго зафиксированы, как указано выше. То есть предполагается, что границы репутации остались такими же, как и в оригинальной игре; иными словами, скрипт генерации никак не опирается на строчки reputation и reputation_names из [game_relations].
    Сокращения также можно использовать парой или в сочетании с обычным числом.
    Примеры:
        reputation = 100                ; ровно 100
        reputation = -100, 100          ; случайное число от -100 до 100 (включительно)
        reputation = good               ; reputation = 50, 149 (хорошо)
        reputation = very_good          ; reputation = 150, 999 (очень хорошо)
        reputation = good, good         ; reputation = 50, 149 (хорошо)
        reputation = good, very_good    ; reputation = 50, 999 (хорошо или очень хорошо)
        reputation = good, excellent    ; reputation = 50, 1500 (хорошо, очень хорошо или отлично)
        reputation = good, 100          ; reputation = 50, 100
        reputation = 0, good            ; reputation = 0, 149
    Указывается ОБЯЗАТЕЛЬНО.
money
    Кол-во денег NPC.
    Если указано одно положительное число, то min и max ему приравниваются.
    Если указаны два положительных числа через запятую, то они соответствуют min и max.
    Если указать "inf" или "infinitive" (без кавычек), то установится бесконечное кол-во денег.
    Не рекомендуется указывать нулевое число: если min или max значение money будет нулевым, то игровой движок полностью проигнорирует <money> в характеристике NPC (вместо этого будет использовано значение поля money из секции объекта NPC в all.spawn).
    Указывается ОБЯЗАТЕЛЬНО.
visual
    Модель NPC.
    Указывается ОБЯЗАТЕЛЬНО.
snd_config
    Звуковая схема NPC.
    Если не указано, то просто не добавляется в характеристику.
crouch_type
    Не знаю, что это такое. В характеристиках из оригинального ТЧ есть нестрогая корреляция этого значения с группировкой NPC.
    Допустимые значения: -1, 0, 1.
    Лучше не указывать. В этом случае скрипт подберёт одно и трёх значения по группировке NPC.
w0, w1, w2
    Списки секций оружия, перечисленных через запятую.
    В зависимости от выбранного режима генерации ($GENMODE) указанное оружие будет скомбинировано друг с другом.
    Смысл полей такой:
        w0 - список одиночного оружие
        w1 - список оружия первого слота (пистолеты)
        w2 - список оружия второго слота (автоматы, дробовики, снайперки, гранатомёты)
    Значение по умолчанию - пустой список.
    Вместо секции конкретного оружия можно указать специальное значение - одно нижнее подчёркивание (_). Грубо говоря, это секция "без оружия". Алгоритм генерации воспринимает это значение как элемент списка, но не пытается прописать его в характеристику как какой-то предмет или оружие. Это специальное значение необходимо, когда нужно сгенерировать характеристику вообще без оружия или, например, с автоматом (w2), но без пистолета (w1).
    В скобках после секции можно указать дополнительные параметры (синтаксис - как в [spawn]), например:
        w1 = wpn_pm (1, cond=0.8 scope silencer), wpn_pb (1, scope), wpn_raging_bull
    Если в дополнительных параметрах указаны нулевое количество или нулевая вероятность, то этот предмет будет считаться "пустым", т.е. этот предмет будет учитываться при выборе комбинации оружия, но в характеристике прописываться не будет. К слову, в том же смысле "пустым" считается специальное значение списка - нижнее подчёркивание (_). Таким образом, следующие строки эквивалентны:
        w0 = wpn_bizon, wpn_ump45 (0), wpn_vihr
        w0 = wpn_bizon, wpn_ump45 (1, prob=0), wpn_vihr
        w0 = wpn_bizon, _, wpn_vihr
items
    Список дополнительных предметов для NPC, перечисленных через запятую.
    Значение по умолчанию - пустой список.
    Обрабатывается абсолютно так же, как и списки оружия (см. w0, w1, w2).
    Пример использования:
        items = bread (3), kolbasa (2), vodka, device_torch (1, prob=0.5)
    Следующие строки эквивалентны:
        items = bread, kolbasa (0), conserva
        items = bread, kolbasa (1, prob=0), conserva
        items = bread, _, conserva
include_supplies
    Включение файлов с доп. предметами для NPC, которые будут у него, пока он жив.
    Имена файлов перечисляются через запятую. Возможные варианты:
    character_drugs, character_food, character_items
    По умолчанию ничего не добавляется.
include
    Включение файлов с диалогами и critical_wound_weights.
    Значение по умолчанию: character_criticals, character_dialogs
    Не рекомендую пропускать character_criticals (не знаю точно, зачем тамошний critical_wound_weights, но я его всегда указывал).
    [vanilla] Файла character_criticals из значения по умолчанию в оригинальных ресурсах игры нет, поэтому нужно либо его добавить, либо в открытую указать какой-нибудь из существующих. Какой из character_criticals_* включать именно не имеет значения - они все одинаковые (можно указать, например, character_criticals_3).
start_dialog
    Диалог с начальной фразой от NPC.
    Поддерживается указание списка из нескольких диалогов (через запятую), но рекомендуется указывать максимум только один диалог, потому что игровой движок берёт только первый, а остальные игнорирует.
    Если не указано, то просто не добавляется в характеристику.
actor_dialog
    Список диалогов с начальной фразой от ГГ.
    Если не указано, то просто не добавляется в характеристику.


--########################
--#### ПРИНЦИП РАБОТЫ ####
--########################
На основе каждой секции, имя которой не начинается с символа @, осуществляется генерация характеристик.
Секции, имя которых начинается с символа @, - вспомогательные ("абстрактные"); как уже было сказано, генерация по ним напрямую не осуществляется, поэтому они используются только для наследования от них полей уже генерирующей секцией.
Для сброса значения поля после наследования (например, чтобы восстановить значение по умолчанию) необходимо указать его без присвоения.
Для каждой настройки будет сгенерирован ряд характеристик с отличающимся вооружением.
Принцип генерации задаётся настройкой $GENMODE.
В общем случае, w0 - оружие, выдающееся индивидуально, а w1 и w2 комбинируются между собой.
Патроны для оружия подбираются автоматически.
Реализована поддержка многоприцельности: если в секции оружия существует поле scope_respawn и scope_status = 2, то прицел будет прикреплён автоматически.


--#########################
--#### Доп. информация ####
--#########################
Программа также осуществляет следующие проверки (не влияют на вывод, а только выводят предупреждения в лог):
- name:             существует ли такая строка в string_table или такой генератор имён (GENERATE_NAME_*)
- icon:             существует ли текстура с указанным id
- bio:              существует ли такая строка в string_table
- community:        зарегистрирована ли указанная группировка
- terrain_sect:     существует ли указанная секция
- visual:           существует ли указанный файл
- snd_config:       существует ли указанная папка
- include_supplies: существуют ли указанные файлы
- include:          существуют ли указанные файлы
- start_dialog:     существует ли указанный диалог
- actor_dialog:     существуют ли указанные диалоги

Другие проверки:
- rank:                         ранг не меньше 100, чтобы избежать бага с абсурдной точностью стрельбы NPC (только предупреждение в лог)
- money:                        ненулевое значение, иначе игровой движок проигнорирует <money> в характеристике (только предупреждение в лог)
- w0, w1, w2:                   действительно ли указано оружие (только предупреждение в лог)
- w1, w2:                       проверка типа оружия (только предупреждение в лог)
- w0, w1, w2, items:            существуют ли перечисленные секции (ошибка генерации)
- start_dialog:                 указано не более 1 диалога (только предупреждение в лог)
- start_dialog, actor_dialog:   не повторяется ли какой-нибудь диалог (только предупреждение в лог)

Ограничения:
- Невозможно выбирать тип автоматически добавляемых боеприпасов (например, добавлять именно бронебойные патроны, а не просто первую секцию из списка ammo_class)
- Определённые ограничения на выдачу оружия без боеприпасов*
    * Можно просто прописать оружие в items, и тогда для него не будут автоматически добавляться боеприпасы. Но такой "трюк" не сработает, если есть необходимость варьировать набор оружия в рамках одного класса (режимы генерации 0 и 2).
- XML файлы всегда генерируются с заголовком и корнем (они были бы не нужны, если бы файл характеристики был вписан в другой файл include-директивой).
- Не генерируется npc_profile.xml


--################################
--#### ПРИМЕР СО ВСЕМИ ПОЛЯМИ ####
--################################
[COMPLETE]
$GENMODE = 0
name = GENERATE_NAME_stalker
icon = ui_npc_u_none
bio = sim_stalker_general_bio
class = ip_killer_2e
community = killer
terrain_sect = stalker_killer_terrain
rank = 2e
reputation = neutral
money = 50, 500
visual = actors\killer\killer_1_antigas
snd_config = characters_voice\human_03\killer\
crouch_type = -1
w0 = wpn_mp5, wpn_p90
w1 = wpn_pm, wpn_fort, wpn_hpsa, wpn_desert_eagle
w2 = wpn_l85, wpn_lr300, wpn_g36
items = device_torch, grenade_rgd5 (1, prob=0.5)
include_supplies = character_drugs, character_food, character_items
include = character_criticals, character_dialogs
start_dialog = dm_hello_dialog
actor_dialog = dm_cool_info_dialog, dm_help_wounded_medkit_dialog


--#######################################
--#### ПРИМЕР С ОБЯЗАТЕЛЬНЫМИ ПОЛЯМИ ####
--#######################################
[MANDATORY]
$GENMODE = 0
class = ip_killer_2e
community = killer
rank = 2e
reputation = neutral
money = 50, 500
visual = actors\killer\killer_1_antigas
